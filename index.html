<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rejection Challenge</title>
  <meta name="description" content="Spin an in-person prompt. Log accepted or rejected. Build a rejection streak. No login." />

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='16' fill='%23140b09'/%3E%3Cpath d='M18 38c10 6 18 6 28 0' stroke='%23fff2ea' stroke-width='4' fill='none' stroke-linecap='round'/%3E%3Cpath d='M22 26h0' stroke='%23fff2ea' stroke-width='6' stroke-linecap='round'/%3E%3Cpath d='M42 26h0' stroke='%23fff2ea' stroke-width='6' stroke-linecap='round'/%3E%3C/svg%3E" />

  <!-- Better typography -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,600;9..144,700&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Share-card capture -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --bg:#120807;
      --card:#1a0f0d;
      --text:#fff2ea;
      --muted:rgba(255,242,234,.72);
      --muted2:rgba(255,242,234,.56);

      --accent:#ff7a59;
      --accent2:#ffb86b;
      --mint:#53e2b0;
      --pink:#ff5b85;

      --border:rgba(255,242,234,.10);
      --border2:rgba(255,242,234,.14);

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --shadow2: 0 10px 26px rgba(0,0,0,.35);

      --r1:22px;
      --r2:16px;
      --r3:12px;

      --display: "Fraunces", ui-serif, Georgia, serif;
      --sans: "Outfit", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --gap:14px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 520px at 10% 0%, rgba(255,122,89,.35), transparent 60%),
        radial-gradient(900px 520px at 100% 10%, rgba(255,184,107,.22), transparent 55%),
        radial-gradient(700px 420px at 40% 120%, rgba(83,226,176,.12), transparent 60%),
        var(--bg);
      letter-spacing:.1px;
    }

    a{color:inherit; text-decoration:none}
    .wrap{max-width:1160px; margin:0 auto; padding:22px 16px 80px}

    /* Top header */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 10px;
      border-radius:var(--r1);
      border:1px solid rgba(255,242,234,.10);
      background:rgba(255,242,234,.04);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:240px;
    }

    .logo{
      width:42px; height:42px;
      border-radius:16px;
      border:1px solid var(--border);
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,184,107,.55), transparent 70%),
        radial-gradient(18px 18px at 70% 70%, rgba(255,122,89,.45), transparent 70%),
        rgba(255,242,234,.08);
      box-shadow: var(--shadow2);
      display:grid; place-items:center;
      flex:0 0 auto;
    }

    .logo svg{opacity:.95}

    .brandText{display:flex; flex-direction:column; gap:2px}
    .brandName{
      font-weight:900;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .brandName .name{font-size:16px}
    .brandSub{color:var(--muted); font-size:12px; font-weight:500}

    .pills{display:flex; gap:8px; flex-wrap:wrap}
    .pill{
      font-family:var(--mono);
      font-size:12px;
      padding:5px 9px;
      border-radius:999px;
      border:1px solid rgba(255,242,234,.12);
      background:rgba(255,242,234,.06);
      color:var(--muted);
      white-space:nowrap;
    }

    .actions{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}

    /* Buttons */
    .btn{
      appearance:none;
      border:1px solid rgba(255,242,234,.14);
      background:rgba(255,242,234,.08);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:750;
      cursor:pointer;
      transition: transform .06s ease, filter .15s ease, background .15s ease;
      user-select:none;
      text-align:center;
    }
    .btn:hover{filter:brightness(1.06)}
    .btn:active{transform:translateY(1px) scale(.99)}
    .btn.small{padding:8px 10px; font-size:13px}
    .btn.primary{
      border-color:rgba(255,184,107,.28);
      background:linear-gradient(90deg, rgba(255,122,89,.95), rgba(255,184,107,.82));
    }
    .btn.good{
      border-color:rgba(83,226,176,.32);
      background:linear-gradient(90deg, rgba(83,226,176,.92), rgba(83,226,176,.62));
    }
    .btn.bad{
      border-color:rgba(255,91,133,.32);
      background:linear-gradient(90deg, rgba(255,91,133,.92), rgba(255,91,133,.62));
    }
    .btn.ghost{background:rgba(255,242,234,.06)}

    /* Sections */
    .hero{
      margin-top:var(--gap);
      border-radius:var(--r1);
      border:1px solid rgba(255,242,234,.10);
      background:
        radial-gradient(1200px 420px at 0% 0%, rgba(255,122,89,.22), transparent 60%),
        radial-gradient(1200px 420px at 100% 0%, rgba(255,184,107,.18), transparent 60%),
        rgba(255,242,234,.04);
      box-shadow: var(--shadow);
      padding:18px;
    }

    .heroTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }

    .hero h1{
      margin:0;
      font-family:var(--display);
      font-size:36px;
      line-height:1.03;
      letter-spacing:.2px;
      max-width:18ch;
    }

    .hero p{
      margin:10px 0 0;
      color:var(--muted);
      line-height:1.55;
      max-width:70ch;
      font-weight:500;
      font-size:15px;
    }

    .toggle{
      display:flex;
      gap:8px;
      align-items:center;
      border:1px solid rgba(255,242,234,.12);
      background:rgba(255,242,234,.06);
      border-radius:999px;
      padding:6px;
      height:fit-content;
    }
    .chip{
      border:0;
      background:transparent;
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      font-weight:850;
      cursor:pointer;
      font-family:var(--sans);
      letter-spacing:.1px;
    }
    .chip.on{
      color:var(--text);
      background:rgba(255,242,234,.10);
      border:1px solid rgba(255,242,234,.12);
    }

    details{
      margin-top:12px;
      border:1px solid rgba(255,242,234,.10);
      border-radius:18px;
      background:rgba(0,0,0,.14);
      padding:10px 12px;
    }
    summary{
      cursor:pointer;
      font-weight:800;
      color:var(--text);
      list-style:none;
    }
    summary::-webkit-details-marker{display:none}
    .smallList{margin:10px 0 0; padding-left:18px; color:var(--muted); line-height:1.55}
    .smallList li{margin:6px 0}

    /* Main layout */
    .wheelWrap{
      margin-top:var(--gap);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:var(--gap);
      align-items:stretch;
    }
    @media (max-width: 860px){
      .wheelWrap{grid-template-columns:1fr}
    }

    .card{
      border:1px solid var(--border);
      border-radius:var(--r1);
      background: linear-gradient(180deg, rgba(26,15,13,.92), rgba(26,15,13,.72));
      box-shadow: var(--shadow);
      padding:16px;
    }

    /* Wheel */
    .wheelBox{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
      border-radius:var(--r1);
      border:1px solid rgba(255,242,234,.10);
      background:rgba(0,0,0,.12);
      position:relative;
      overflow:hidden;
      min-height:340px;
    }
    .pointer{
      position:absolute;
      top:12px;
      left:50%;
      transform:translateX(-50%);
      width:0; height:0;
      border-left:12px solid transparent;
      border-right:12px solid transparent;
      border-top:18px solid rgba(255,242,234,.92);
      filter:drop-shadow(0 10px 10px rgba(0,0,0,.35));
      z-index:6;
    }
    .wheel{
      width:260px; height:260px;
      border-radius:50%;
      border:1px solid rgba(255,242,234,.14);
      box-shadow: inset 0 0 0 10px rgba(0,0,0,.18), var(--shadow2);
      background:
        conic-gradient(
          rgba(255,122,89,.92),
          rgba(255,184,107,.92),
          rgba(83,226,176,.92),
          rgba(255,91,133,.92),
          rgba(255,184,107,.92),
          rgba(255,122,89,.92)
        );
      transform: rotate(0deg);
      transition: transform 1.95s cubic-bezier(.10,.88,.16,1);
    }
    .wheelLabel{
      position:absolute;
      width:260px; height:260px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:18px;
      pointer-events:none;
      z-index:7;
    }
    .wheelLabel .inside{
      width:198px;
      border-radius:18px;
      border:1px solid rgba(255,242,234,.14);
      background:rgba(18,8,7,.74);
      box-shadow: var(--shadow2);
      padding:12px 12px;
      font-weight:850;
      line-height:1.22;
      backdrop-filter: blur(6px);
    }
    .wheelLabel .inside .big{
      font-family:var(--display);
      font-weight:700;
      font-size:18px;
      line-height:1.12;
      letter-spacing:.2px;
    }
    .wheelLabel .inside .sub{
      display:block;
      margin-top:8px;
      font-size:12px;
      font-weight:650;
      color:var(--muted);
      font-family:var(--mono);
    }

    /* Prompt / tracker */
    .challenge{
      border-radius:var(--r1);
      border:1px solid rgba(255,242,234,.12);
      background:
        radial-gradient(900px 260px at 0% 0%, rgba(255,122,89,.14), transparent 60%),
        radial-gradient(900px 260px at 100% 0%, rgba(255,184,107,.12), transparent 60%),
        rgba(0,0,0,.14);
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height:340px;
    }

    .challengeTop{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
    }
    .meta{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
      font-family:var(--mono);
    }
    .tag{
      border:1px solid rgba(255,242,234,.12);
      background:rgba(255,242,234,.06);
      padding:4px 8px;
      border-radius:999px;
    }

    .promptTitle{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .promptTitle .h{
      font-weight:900;
      letter-spacing:.2px;
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
    }
    .promptTitle .tip{
      color:var(--muted2);
      font-size:12px;
      font-weight:500;
    }

    .challengeText{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:.1px;
      line-height:1.22;
      min-height:66px;
    }

    label{display:block; font-size:12px; color:var(--muted); margin:8px 0 6px}
    select, input[type="text"], textarea, input[type="range"]{
      width:100%;
      border-radius:14px;
      border:1px solid rgba(255,242,234,.12);
      background:rgba(0,0,0,.18);
      color:var(--text);
      padding:10px 12px;
      outline:none;
      font-family:var(--sans);
    }
    textarea{min-height:88px; resize:vertical}

    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .row > *{flex:1 1 180px}

    /* Stats + game */
    .grid{
      margin-top:var(--gap);
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:var(--gap);
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    .sectionHead{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .sectionHead h2{
      margin:0;
      font-size:14px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .hint{color:var(--muted); font-size:12px; font-weight:500}

    .statgrid{display:grid; grid-template-columns: repeat(3,1fr); gap:10px}
    @media (max-width:520px){ .statgrid{grid-template-columns:1fr} }
    .stat{
      border-radius:18px;
      border:1px solid rgba(255,242,234,.10);
      background:rgba(0,0,0,.16);
      padding:12px;
    }
    .stat .k{color:var(--muted); font-size:11px}
    .stat .v{font-weight:950; font-size:22px; margin-top:6px}

    .progressWrap{margin-top:10px}
    .progressRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      font-weight:500;
    }
    .progressBar{
      height:10px;
      width:100%;
      border-radius:999px;
      background:rgba(255,242,234,.08);
      border:1px solid rgba(255,242,234,.10);
      overflow:hidden;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.12);
    }
    .progressFill{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(255,122,89,.92), rgba(255,184,107,.88), rgba(83,226,176,.84));
    }

    table{width:100%; border-collapse:collapse; font-size:13px; margin-top:10px}
    th,td{border-bottom:1px solid rgba(255,242,234,.08); padding:10px 8px; vertical-align:top}
    th{color:var(--muted); font-size:12px; text-align:left}
    td small{color:var(--muted); font-size:12px}

    /* Badge shelf */
    .badges{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 520px){ .badges{grid-template-columns:1fr 1fr} }

    .badge{
      border-radius:18px;
      border:1px solid rgba(255,242,234,.10);
      background:rgba(0,0,0,.16);
      padding:10px;
      display:flex;
      gap:10px;
      align-items:center;
      min-height:64px;
    }
    .badge.locked{opacity:.45}
    .badgeIcon{
      width:38px; height:38px;
      border-radius:14px;
      border:1px solid rgba(255,242,234,.12);
      background:rgba(255,242,234,.06);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .badgeIcon svg{opacity:.95}
    .badgeText{display:flex; flex-direction:column; gap:2px}
    .badgeText .t{font-weight:900; font-size:13px}
    .badgeText .d{color:var(--muted); font-size:11px; font-weight:500}

    /* Share card */
    .shareCard{
      margin-top:12px;
      border-radius:20px;
      border:1px solid rgba(255,242,234,.12);
      background:
        radial-gradient(900px 320px at 0% 0%, rgba(255,122,89,.20), transparent 60%),
        radial-gradient(900px 320px at 100% 0%, rgba(255,184,107,.16), transparent 60%),
        rgba(0,0,0,.14);
      padding:14px;
    }

    .shareTop{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:flex-start;
    }

    .shareTop .name{font-weight:950}
    .shareBig{
      margin-top:10px;
      font-weight:950;
      font-size:18px;
      line-height:1.25;
    }
    .shareTags{
      margin-top:10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      color:var(--muted);
      font-family:var(--mono);
      font-size:12px;
    }

    /* Toast + confetti */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,242,234,.14);
      background:rgba(20,10,8,.85);
      box-shadow: var(--shadow2);
      display:none;
      z-index:9999;
      max-width:min(92vw, 760px);
      text-align:center;
      font-size:13px;
    }

    #confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:9998;
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M5 16c3.4 2.2 10.6 2.2 14 0" stroke="rgba(255,242,234,.92)" stroke-width="2.4" stroke-linecap="round"/>
            <path d="M8.2 9.4h0" stroke="rgba(255,242,234,.92)" stroke-width="3.4" stroke-linecap="round"/>
            <path d="M15.8 9.4h0" stroke="rgba(255,242,234,.92)" stroke-width="3.4" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="brandText">
          <div class="brandName">
            <span class="name">Rejection Challenge</span>
            <div class="pills">
              <span class="pill">public</span>
              <span class="pill">no login</span>
              <span class="pill">local only</span>
            </div>
          </div>
          <div class="brandSub">Spin a prompt. Do it in person. Log it. Repeat.</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn small" id="exportBtn" title="Download CSV of your logs">Export</button>
        <button class="btn small" id="shareBtn" title="Share the app link">Share</button>
        <button class="btn small" id="resetBtn" title="Clear everything">Reset</button>
      </div>
    </div>

    <section class="hero">
      <div class="heroTop">
        <div>
          <h1>Make rejection feel normal.</h1>
          <p>
            Quick reps beat motivation. Spin an in-person ask, do it politely, then log the result.
            Your streak moves only when you log a rejection.
          </p>

          <details>
            <summary>Ground rules</summary>
            <ul class="smallList">
              <li>In person only. No online asks for the streak.</li>
              <li>No means stop. No arguing. No guilt.</li>
              <li>Be brief and respectful. Do not interrupt someone rushing.</li>
              <li>Consent required for photos or video.</li>
              <li>Logs are saved only in your browser (not shared).</li>
            </ul>
          </details>
        </div>

        <div class="toggle" role="group" aria-label="Mode toggle">
          <button class="chip on" id="modeDaily">Daily</button>
          <button class="chip" id="modeRandom">Random</button>
        </div>
      </div>

      <div class="wheelWrap">
        <div class="wheelBox" aria-label="Prompt wheel">
          <div class="pointer" aria-hidden="true"></div>
          <div class="wheel" id="wheel"></div>

          <!-- Prompt now shows in the center -->
          <div class="wheelLabel">
            <div class="inside">
              <div class="big" id="wheelBig">Spin to roll a prompt</div>
              <span class="sub" id="wheelSub">Space to spin. R = rejected. A = accepted.</span>
            </div>
          </div>
        </div>

        <div class="challenge" aria-label="Tracker">
          <div class="challengeTop">
            <div class="meta">
              <span class="tag" id="mCat">category: any</span>
              <span class="tag" id="mDiff">difficulty: 3</span>
              <span class="tag" id="mMode">mode: daily</span>
            </div>
            <div class="row" style="flex:0 0 auto">
              <button class="btn small" id="copyLinkBtn">Copy link</button>
              <button class="btn primary" id="spinBtn">Spin</button>
            </div>
          </div>

          <div class="promptTitle">
            <div class="h">Your prompt</div>
            <div class="tip" id="miniHint">Do it, then log accepted or rejected.</div>
          </div>

          <!-- Prompt also shows here -->
          <p class="challengeText" id="challengeText">Your prompt will appear here.</p>

          <div class="row">
            <div>
              <label for="category">Category</label>
              <select id="category">
                <option value="any" selected>Any</option>
                <option value="food">Food / cafe</option>
                <option value="social">Social</option>
                <option value="help">Ask for help</option>
                <option value="negotiation">Negotiation</option>
                <option value="weird">Wholesome weird</option>
                <option value="career">Career</option>
              </select>
            </div>

            <div>
              <label for="difficulty">Difficulty</label>
              <input id="difficulty" type="range" min="1" max="5" value="3" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="where">Where (optional)</label>
              <input id="where" type="text" placeholder="coffee shop, campus, gym" />
            </div>
            <div>
              <label for="who">Who (optional)</label>
              <input id="who" type="text" placeholder="barista, stranger, classmate" />
            </div>
          </div>

          <label for="note">Note (optional)</label>
          <textarea id="note" placeholder="One quick detail. Keep it short."></textarea>

          <div class="row" style="margin-top:2px">
            <button class="btn good" id="acceptedBtn">Accepted</button>
            <button class="btn bad" id="rejectedBtn">Rejected</button>
          </div>
        </div>
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <div class="sectionHead">
          <h2>Stats</h2>
          <div class="hint">Streak counts only on days with a rejection log.</div>
        </div>

        <div class="statgrid">
          <div class="stat">
            <div class="k">Rejection streak (days)</div>
            <div class="v" id="streak">0</div>
          </div>
          <div class="stat">
            <div class="k">Level</div>
            <div class="v" id="level">1</div>
          </div>
          <div class="stat">
            <div class="k">XP</div>
            <div class="v" id="xp">0</div>
          </div>
        </div>

        <div class="progressWrap">
          <div class="hint" id="milestoneText">Next milestone: 3-day streak</div>
          <div class="progressBar" aria-label="Streak progress">
            <div class="progressFill" id="streakProgress"></div>
          </div>
          <div class="progressRow">
            <div id="progressLeft">0 / 3</div>
            <div id="progressRight">Keep it polite. Take the rep.</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="sectionHead">
            <h2>Recent logs</h2>
            <div class="hint">Saved only on this device/browser.</div>
          </div>

          <table>
            <thead>
              <tr>
                <th style="min-width:170px">Time</th>
                <th>Prompt</th>
                <th style="min-width:110px">Result</th>
              </tr>
            </thead>
            <tbody id="logBody">
              <tr><td colspan="3" style="color:var(--muted)">No logs yet.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <aside class="card">
        <div class="sectionHead">
          <h2>Badges</h2>
          <div class="hint">Unlocked locally.</div>
        </div>

        <div class="badges" id="badges"></div>

        <div style="margin-top:16px" class="sectionHead">
          <h2>Share card</h2>
          <div class="hint">Generate a prompt first.</div>
        </div>

        <div class="shareCard" id="shareCard">
          <div class="shareTop">
            <div class="name">Rejection Challenge</div>
            <div class="pill" id="shareStamp">daily</div>
          </div>

          <div class="shareBig" id="shareText">Spin to get a prompt.</div>

          <div class="shareTags">
            <span class="tag" id="shareCat">category:any</span>
            <span class="tag" id="shareDiff">d3</span>
            <span class="tag">rule:no means stop</span>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <button class="btn small" id="copyImgBtn">Copy image</button>
          <button class="btn small" id="downloadImgBtn">Download</button>
        </div>
      </aside>
    </div>

    <div class="toast" id="toast"></div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // UI
  const modeDaily = $("modeDaily");
  const modeRandom = $("modeRandom");
  const spinBtn = $("spinBtn");
  const wheel = $("wheel");
  const wheelBig = $("wheelBig");
  const wheelSub = $("wheelSub");

  const category = $("category");
  const difficulty = $("difficulty");

  const challengeText = $("challengeText");
  const miniHint = $("miniHint");
  const mCat = $("mCat");
  const mDiff = $("mDiff");
  const mMode = $("mMode");

  const where = $("where");
  const who = $("who");
  const note = $("note");

  const acceptedBtn = $("acceptedBtn");
  const rejectedBtn = $("rejectedBtn");

  const exportBtn = $("exportBtn");
  const shareBtn = $("shareBtn");
  const resetBtn = $("resetBtn");
  const copyLinkBtn = $("copyLinkBtn");

  const streakEl = $("streak");
  const levelEl = $("level");
  const xpEl = $("xp");
  const logBody = $("logBody");

  const milestoneText = $("milestoneText");
  const streakProgress = $("streakProgress");
  const progressLeft = $("progressLeft");
  const progressRight = $("progressRight");

  const badgesHost = $("badges");

  const shareCard = $("shareCard");
  const shareStamp = $("shareStamp");
  const shareText = $("shareText");
  const shareCat = $("shareCat");
  const shareDiff = $("shareDiff");
  const copyImgBtn = $("copyImgBtn");
  const downloadImgBtn = $("downloadImgBtn");

  const toast = $("toast");
  const confettiCanvas = $("confetti");
  const ctx = confettiCanvas.getContext("2d");

  // Storage keys
  const K_LOGS = "rc_logs_v3";
  const K_STREAK = "rc_streak_v3";
  const K_LAST_REJ_DAY = "rc_last_rej_day_v3";
  const K_GAME = "rc_game_v3";

  let mode = "daily"; // daily | random
  let current = null;
  let spinRotation = 0;

  function resizeConfetti(){
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resizeConfetti);
  resizeConfetti();

  function toastMsg(msg){
    toast.textContent = msg;
    toast.style.display = "block";
    clearTimeout(toast._t);
    toast._t = setTimeout(() => toast.style.display = "none", 1800);
  }

  function dayKey(d = new Date()){ return d.toISOString().slice(0,10); }

  function hash32(str){
    let h = 2166136261;
    for (let i=0;i<str.length;i++){
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  }
  function seededIndex(n, seed){
    const s = hash32(seed);
    const x = (Math.imul(s, 1664525) + 1013904223) >>> 0;
    return n ? (x % n) : 0;
  }

  function loadJSON(key, fallback){
    try { return JSON.parse(localStorage.getItem(key) || "null") ?? fallback; }
    catch { return fallback; }
  }
  function saveJSON(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  const challenges = [
    {cat:"food", diff:1, text:"Ask the barista to recommend something that is not on the menu."},
    {cat:"food", diff:2, text:"Ask if they can make your drink less sweet."},
    {cat:"food", diff:3, text:"Ask for a surprise under $5 and let them pick."},
    {cat:"food", diff:4, text:"Ask for a small customization (swap a side). If no, say thanks and move on."},
    {cat:"food", diff:5, text:"Ask for a small free add-on. If no, smile and end it."},

    {cat:"social", diff:1, text:"Give a sincere compliment to a stranger and walk away."},
    {cat:"social", diff:2, text:"Ask someone where they got an item because you like it."},
    {cat:"social", diff:3, text:"Ask a stranger to rate your outfit 1 to 10. Thank them either way."},
    {cat:"social", diff:4, text:"Ask someone to take a quick photo of you. Offer to return the favor."},
    {cat:"social", diff:5, text:"Ask a group if you can join for 60 seconds to practice small talk, then leave."},

    {cat:"help", diff:1, text:"Ask for directions to a place you already know."},
    {cat:"help", diff:2, text:"Ask someone for a nearby recommendation they actually like."},
    {cat:"help", diff:3, text:"Ask to borrow a pen for 30 seconds."},
    {cat:"help", diff:4, text:"Ask an employee to help you choose between two options and why."},
    {cat:"help", diff:5, text:"Ask someone to hear your 15-second intro and give one note."},

    {cat:"negotiation", diff:1, text:"Ask if there is a student discount."},
    {cat:"negotiation", diff:2, text:"Ask if they can waive a small add-on fee once."},
    {cat:"negotiation", diff:3, text:"Ask for a small upgrade (size, add-on, seat)."},
    {cat:"negotiation", diff:4, text:"Ask for $1 to $2 off a small purchase. If no, end it."},
    {cat:"negotiation", diff:5, text:"Ask for a free extra. If no, say thanks and stop."},

    {cat:"weird", diff:1, text:"Ask someone a harmless silly question: do pigeons have a leader?"},
    {cat:"weird", diff:2, text:"Ask a cashier: is today more of a 7 or a 9?"},
    {cat:"weird", diff:3, text:"Ask for a 10-second pep talk."},
    {cat:"weird", diff:4, text:"Ask someone for one life hack that saves time."},
    {cat:"weird", diff:5, text:"Ask for a 5-second 'you got this' video (only with consent)."},

    {cat:"career", diff:1, text:"Ask someone what they do for work and what they like about it."},
    {cat:"career", diff:2, text:"Ask for one piece of advice for someone early in their career."},
    {cat:"career", diff:3, text:"Ask if they are open to a 10-minute coffee chat sometime."},
    {cat:"career", diff:4, text:"Ask if they know one person you should meet and why."},
    {cat:"career", diff:5, text:"Ask a professional for feedback on your 15-second intro, on the spot."}
  ];

  function pool(){
    const cat = category.value;
    const diff = parseInt(difficulty.value, 10);
    let p = challenges.filter(c => c.diff === diff);
    if (cat !== "any") p = p.filter(c => c.cat === cat);
    if (!p.length){
      p = challenges.slice();
      if (cat !== "any") p = p.filter(c => c.cat === cat);
      if (!p.length) p = challenges.slice();
    }
    return p;
  }

  function pick(){
    const p = pool();
    if (mode === "daily"){
      const seed = dayKey() + "|" + category.value + "|" + difficulty.value;
      return p[seededIndex(p.length, seed)];
    }
    return p[Math.floor(Math.random() * p.length)];
  }

  function encodeChallenge(ch){
    const payload = {cat: ch.cat, diff: ch.diff, text: ch.text, mode, fCat: category.value, fDiff: difficulty.value};
    const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
    return b64.replaceAll("=","");
  }
  function decodeChallenge(str){
    try{
      const pad = str + "===".slice((str.length % 4) || 4);
      const json = decodeURIComponent(escape(atob(pad)));
      const obj = JSON.parse(json);
      if (!obj || !obj.text) return null;
      return obj;
    } catch { return null; }
  }

  function syncMeta(){
    mCat.textContent = "category: " + category.value;
    mDiff.textContent = "difficulty: " + difficulty.value;
    mMode.textContent = "mode: " + mode;

    shareStamp.textContent = mode;
    shareCat.textContent = "category:" + category.value;
    shareDiff.textContent = "d" + difficulty.value;
  }

  function setMode(next){
    mode = next;
    modeDaily.classList.toggle("on", mode === "daily");
    modeRandom.classList.toggle("on", mode === "random");

    wheelSub.textContent = (mode === "daily")
      ? "Daily: same prompt today (same filters)"
      : "Random: fresh roll each spin";

    syncMeta();
  }

  // Confetti (small, tasteful)
  let confetti = [];
  function burstConfetti(){
    const w = confettiCanvas.width;
    const h = confettiCanvas.height;
    const n = 90;
    confetti = [];
    for (let i=0;i<n;i++){
      confetti.push({
        x: w*0.5 + (Math.random()*80 - 40),
        y: h*0.18 + (Math.random()*40 - 20),
        vx: (Math.random()*6 - 3),
        vy: (Math.random()*-8 - 4),
        g: 0.22 + Math.random()*0.12,
        r: 3 + Math.random()*3,
        life: 120 + Math.floor(Math.random()*40)
      });
    }
    animateConfetti();
  }

  function animateConfetti(){
    let frames = 0;
    const tick = () => {
      frames++;
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);

      confetti.forEach(p => {
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 1;

        const a = Math.max(0, Math.min(1, p.life / 140));
        ctx.globalAlpha = a;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fillStyle = (frames % 3 === 0) ? "rgba(255,184,107,.95)" : (frames % 3 === 1) ? "rgba(255,122,89,.95)" : "rgba(83,226,176,.95)";
        ctx.fill();
      });

      ctx.globalAlpha = 1;

      confetti = confetti.filter(p => p.life > 0 && p.y < confettiCanvas.height + 30);
      if (confetti.length && frames < 170){
        requestAnimationFrame(tick);
      } else {
        ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      }
    };
    requestAnimationFrame(tick);
  }

  function spin(){
    challengeText.textContent = "Spinning...";
    miniHint.textContent = "Prompt appears here and in the wheel center.";
    wheelBig.textContent = "Rolling...";

    const ch = pick();
    current = ch;

    const extra = 1080 + Math.floor(Math.random() * 720);
    spinRotation = (spinRotation + extra) % 3600;
    wheel.style.transform = `rotate(${spinRotation}deg)`;

    setTimeout(() => {
      challengeText.textContent = ch.text;
      wheelBig.textContent = ch.text;
      shareText.textContent = ch.text;
      miniHint.textContent = "Do it, then log accepted or rejected.";

      const url = new URL(location.href);
      url.searchParams.set("c", encodeChallenge(ch));
      history.replaceState(null, "", url.toString());

      toastMsg("Prompt ready.");
    }, 720);
  }

  function loadLogs(){ return loadJSON(K_LOGS, []); }
  function saveLogs(v){ saveJSON(K_LOGS, v); }

  function loadStreak(){ return loadJSON(K_STREAK, 0); }
  function saveStreak(v){ saveJSON(K_STREAK, v); }

  function loadGame(){ return loadJSON(K_GAME, {xp:0, level:1}); }
  function saveGame(g){ saveJSON(K_GAME, g); }

  function levelForXP(xp){
    let lvl = 1, need = 120, spent = 0;
    while (xp >= spent + need){
      spent += need;
      lvl += 1;
      need = Math.floor(need * 1.22) + 25;
    }
    return {level:lvl};
  }

  function updateStreakOnRejection(){
    const today = dayKey();
    const last = localStorage.getItem(K_LAST_REJ_DAY);
    let s = loadStreak();

    if (!last) s = 1;
    else {
      const d0 = new Date(last+"T00:00:00");
      const d1 = new Date(today+"T00:00:00");
      const diff = Math.round((d1 - d0) / 86400000);
      if (diff === 0) {}
      else if (diff === 1) s += 1;
      else s = 1;
    }
    localStorage.setItem(K_LAST_REJ_DAY, today);
    saveStreak(s);
  }

  function awardXP(entry){
    const g = loadGame();
    const base = (entry.result === "rejected") ? 30 : 12;
    const diffBonus = (entry.diff || 3) * 7;
    const catBonus = (entry.cat === "negotiation" || entry.cat === "career") ? 8 : 0;
    const add = base + diffBonus + catBonus;

    const beforeLevel = g.level;
    g.xp += add;
    g.level = levelForXP(g.xp).level;
    saveGame(g);

    if (g.level > beforeLevel){
      toastMsg("Level up.");
      burstConfetti();
    } else {
      toastMsg("Logged +" + add + " XP");
    }
  }

  // Badge definitions + checks
  const badgeDefs = [
    {id:"b_first_no", title:"First No", desc:"Log your first rejection.", icon:"bolt"},
    {id:"b_streak_3", title:"3-day streak", desc:"Reach a 3-day rejection streak.", icon:"flame"},
    {id:"b_streak_7", title:"7-day streak", desc:"Reach a 7-day rejection streak.", icon:"crown"},
    {id:"b_neg_5", title:"Negotiator", desc:"Log 5 negotiation reps.", icon:"handshake"},
    {id:"b_career_5", title:"Networker", desc:"Log 5 career reps.", icon:"node"},
    {id:"b_social_10", title:"Social 10", desc:"Log 10 social reps.", icon:"spark"}
  ];

  function getBadgeState(logs, streak){
    const negCount = logs.filter(l => l.cat === "negotiation").length;
    const careerCount = logs.filter(l => l.cat === "career").length;
    const socialCount = logs.filter(l => l.cat === "social").length;

    return {
      b_first_no: logs.some(l => l.result === "rejected"),
      b_streak_3: streak >= 3,
      b_streak_7: streak >= 7,
      b_neg_5: negCount >= 5,
      b_career_5: careerCount >= 5,
      b_social_10: socialCount >= 10
    };
  }

  function iconSvg(name){
    const stroke = "rgba(255,242,234,.92)";
    const s2 = "rgba(255,242,234,.72)";
    if (name === "bolt") return `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M13 2L3 14h8l-1 8 11-14h-8l0-6z" stroke="${stroke}" stroke-width="2" stroke-linejoin="round"/>
      </svg>`;
    if (name === "flame") return `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M12 2c2 4-1 5 2 8 2 2 4 3 4 7a6 6 0 0 1-12 0c0-3 2-5 4-7 2-2 0-4 2-8z" stroke="${stroke}" stroke-width="2"/>
      </svg>`;
    if (name === "crown") return `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M4 8l4 4 4-7 4 7 4-4v10H4V8z" stroke="${stroke}" stroke-width="2" stroke-linejoin="round"/>
        <path d="M4 18h16" stroke="${s2}" stroke-width="2" stroke-linecap="round"/>
      </svg>`;
    if (name === "handshake") return `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M8 12l2 2c1 1 3 1 4 0l2-2" stroke="${stroke}" stroke-width="2" stroke-linecap="round"/>
        <path d="M3 12l4-4 4 4-4 4-4-4z" stroke="${s2}" stroke-width="2" stroke-linejoin="round"/>
        <path d="M21 12l-4-4-4 4 4 4 4-4z" stroke="${s2}" stroke-width="2" stroke-linejoin="round"/>
      </svg>`;
    if (name === "node") return `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M7 12a2 2 0 1 0 0 .01" stroke="${stroke}" stroke-width="2"/>
        <path d="M17 7a2 2 0 1 0 0 .01" stroke="${stroke}" stroke-width="2"/>
        <path d="M17 17a2 2 0 1 0 0 .01" stroke="${stroke}" stroke-width="2"/>
        <path d="M9 12l6-4" stroke="${s2}" stroke-width="2" stroke-linecap="round"/>
        <path d="M9 12l6 4" stroke="${s2}" stroke-width="2" stroke-linecap="round"/>
      </svg>`;
    return `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
        <path d="M12 3l1.6 4.8L18 9l-4.4 1.2L12 15l-1.6-4.8L6 9l4.4-1.2L12 3z" stroke="${stroke}" stroke-width="2" stroke-linejoin="round"/>
      </svg>`;
  }

  function renderBadges(logs, streak){
    const have = getBadgeState(logs, streak);
    badgesHost.innerHTML = badgeDefs.map(b => {
      const ok = !!have[b.id];
      return `
        <div class="badge ${ok ? "" : "locked"}" title="${b.desc}">
          <div class="badgeIcon">${iconSvg(b.icon)}</div>
          <div class="badgeText">
            <div class="t">${b.title}</div>
            <div class="d">${b.desc}</div>
          </div>
        </div>
      `;
    }).join("");
  }

  function streakMilestone(streak){
    // Friendly progression for the bar
    const milestones = [3, 7, 14, 30];
    for (const m of milestones){
      if (streak < m) return m;
    }
    return 30;
  }

  function render(){
    const logs = loadLogs();
    const streak = loadStreak();
    const g = loadGame();

    streakEl.textContent = streak;
    levelEl.textContent = g.level;
    xpEl.textContent = g.xp;

    // Streak progress bar toward next milestone
    const next = streakMilestone(streak);
    const pct = Math.max(0, Math.min(100, Math.round((streak / next) * 100)));
    streakProgress.style.width = pct + "%";
    milestoneText.textContent = "Next milestone: " + next + "-day streak";
    progressLeft.textContent = streak + " / " + next;

    const last = localStorage.getItem(K_LAST_REJ_DAY);
    if (!last) progressRight.textContent = "Log a rejection to start the streak.";
    else if (last === dayKey()) progressRight.textContent = "Streak counted today. Another rep is bonus.";
    else progressRight.textContent = "Streak continues only if you log a rejection today.";

    // Logs table
    const show = logs.slice().reverse().slice(0, 10);
    if (!show.length){
      logBody.innerHTML = `<tr><td colspan="3" style="color:var(--muted)">No logs yet.</td></tr>`;
    } else {
      logBody.innerHTML = show.map(l => {
        const dt = new Date(l.time);
        const when = dt.toLocaleString([], {month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"});
        const res = l.result === "rejected" ? "Rejected" : "Accepted";
        return `
          <tr>
            <td>${when}<br><small>${l.cat} d${l.diff} â€¢ ${l.mode}</small></td>
            <td style="font-weight:750">${l.challenge}</td>
            <td>${res}</td>
          </tr>
        `;
      }).join("");
    }

    // Badges
    renderBadges(logs, streak);
  }

  function log(result){
    if (!current){
      toastMsg("Spin first.");
      return;
    }

    const logs = loadLogs();
    const entry = {
      time: new Date().toISOString(),
      result,
      mode,
      cat: current.cat,
      diff: current.diff,
      challenge: current.text,
      where: (where.value || "").trim(),
      who: (who.value || "").trim(),
      note: (note.value || "").trim()
    };

    logs.push(entry);
    saveLogs(logs);

    if (result === "rejected"){
      const before = loadStreak();
      updateStreakOnRejection();
      const afterS = loadStreak();
      if (afterS > before) toastMsg("Rejected logged. Streak updated.");
      else toastMsg("Rejected logged. Streak already counted today.");
    } else {
      toastMsg("Accepted logged.");
    }

    awardXP(entry);

    // Clear fields
    where.value = "";
    who.value = "";
    note.value = "";

    render();
  }

  function exportCSV(){
    const logs = loadLogs();
    if (!logs.length){
      toastMsg("Nothing to export.");
      return;
    }

    const header = ["time_iso","result","mode","category","difficulty","challenge","where","who","note"];
    const rows = logs.map(l => [
      l.time, l.result, l.mode, l.cat, String(l.diff),
      (l.challenge||"").replaceAll('"','""'),
      (l.where||"").replaceAll('"','""'),
      (l.who||"").replaceAll('"','""'),
      (l.note||"").replaceAll('"','""')
    ]);

    const csv = [header.join(","), ...rows.map(r => r.map(v => `"${v}"`).join(","))].join("\n");
    const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "rejection-challenge-logs.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    toastMsg("Exported.");
  }

  async function shareApp(){
    const url = location.origin + location.pathname;
    if (navigator.share){
      try { await navigator.share({title:"Rejection Challenge", text:"Try this:", url}); }
      catch {}
    } else {
      try { await navigator.clipboard.writeText(url); toastMsg("App link copied."); }
      catch { prompt("Copy this link:", url); }
    }
  }

  async function copyLink(){
    const url = location.href;
    try { await navigator.clipboard.writeText(url); toastMsg("Link copied."); }
    catch { prompt("Copy:", url); }
  }

  async function renderShareCard(){
    await new Promise(r => setTimeout(r, 40));
    return html2canvas(shareCard, {backgroundColor: null, scale: 2});
  }

  async function copyShareImage(){
    if (!current){ toastMsg("Spin first."); return; }
    try{
      const canvas = await renderShareCard();
      const blob = await new Promise(res => canvas.toBlob(res, "image/png"));
      if (!blob) throw new Error("no blob");

      if (navigator.clipboard && window.ClipboardItem){
        await navigator.clipboard.write([new ClipboardItem({"image/png": blob})]);
        toastMsg("Image copied.");
      } else {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "rejection-card.png";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
        toastMsg("Downloaded.");
      }
    } catch {
      toastMsg("Could not copy. Try download.");
    }
  }

  async function downloadShareImage(){
    if (!current){ toastMsg("Spin first."); return; }
    const canvas = await renderShareCard();
    const url = canvas.toDataURL("image/png");
    const a = document.createElement("a");
    a.href = url;
    a.download = "rejection-card.png";
    document.body.appendChild(a);
    a.click();
    a.remove();
    toastMsg("Downloaded.");
  }

  function resetAll(){
    if (!confirm("Reset logs and stats on this device?")) return;
    localStorage.removeItem(K_LOGS);
    localStorage.removeItem(K_STREAK);
    localStorage.removeItem(K_LAST_REJ_DAY);
    localStorage.removeItem(K_GAME);

    history.replaceState(null,"", location.origin + location.pathname);
    current = null;

    challengeText.textContent = "Your prompt will appear here.";
    wheelBig.textContent = "Spin to roll a prompt";
    shareText.textContent = "Spin to get a prompt.";
    toastMsg("Reset.");
    render();
  }

  function updateShareMeta(){
    shareStamp.textContent = mode;
    shareCat.textContent = "category:" + category.value;
    shareDiff.textContent = "d" + difficulty.value;
  }

  function spinAndSet(){
    challengeText.textContent = "Spinning...";
    miniHint.textContent = "Prompt appears here and in the wheel center.";
    wheelBig.textContent = "Rolling...";

    const ch = pick();
    current = ch;

    const extra = 1080 + Math.floor(Math.random() * 720);
    spinRotation = (spinRotation + extra) % 3600;
    wheel.style.transform = `rotate(${spinRotation}deg)`;

    setTimeout(() => {
      challengeText.textContent = ch.text;
      wheelBig.textContent = ch.text;
      shareText.textContent = ch.text;
      miniHint.textContent = "Do it, then log accepted or rejected.";

      const url = new URL(location.href);
      url.searchParams.set("c", encodeChallenge(ch));
      history.replaceState(null, "", url.toString());

      toastMsg("Prompt ready.");
    }, 720);
  }

  // Wire up
  modeDaily.addEventListener("click", () => setMode("daily"));
  modeRandom.addEventListener("click", () => setMode("random"));

  spinBtn.addEventListener("click", spinAndSet);
  wheel.addEventListener("click", spinAndSet);

  category.addEventListener("change", () => { syncMeta(); updateShareMeta(); });
  difficulty.addEventListener("input", () => { syncMeta(); updateShareMeta(); });

  acceptedBtn.addEventListener("click", () => log("accepted"));
  rejectedBtn.addEventListener("click", () => log("rejected"));

  exportBtn.addEventListener("click", exportCSV);
  shareBtn.addEventListener("click", shareApp);
  resetBtn.addEventListener("click", resetAll);
  copyLinkBtn.addEventListener("click", copyLink);

  copyImgBtn.addEventListener("click", copyShareImage);
  downloadImgBtn.addEventListener("click", downloadShareImage);

  document.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();
    if (k === " "){ e.preventDefault(); spinAndSet(); }
    if (k === "r") log("rejected");
    if (k === "a") log("accepted");
  });

  // Load from shared link
  const params = new URLSearchParams(location.search);
  const c = params.get("c");
  if (c){
    const decoded = decodeChallenge(c);
    if (decoded){
      setMode(decoded.mode === "random" ? "random" : "daily");
      category.value = ["any","food","social","help","negotiation","weird","career"].includes(decoded.fCat) ? decoded.fCat : "any";
      difficulty.value = String(Math.min(5, Math.max(1, parseInt(decoded.fDiff || 3, 10) || 3)));

      current = {cat: decoded.cat, diff: decoded.diff, text: decoded.text};
      challengeText.textContent = decoded.text;
      wheelBig.textContent = decoded.text;
      shareText.textContent = decoded.text;
      miniHint.textContent = "Do it, then log accepted or rejected.";
    }
  }

  // Init
  setMode("daily");
  syncMeta();
  updateShareMeta();
  render();

})();
</script>
</body>
</html>
